[[!-- Uncomment line below if you want to see all available facets --]]
[[!--     <semantic-search domain='(urlParam "resourceontologyclass" escape=false)' config='[[searchConfigForFieldsFromQuery "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> . ?field <http://www.researchspace.org/resource/system/fields/domain> <http://www.researchspace.org/ontology/EX_Digital_Image> . ?field <http://www.researchspace.org/resource/system/fields/range> ?range . ?field  <http://www.researchspace.org/resource/system/fields/category> <http://www.researchspace.org/resource/system/category/image> . OPTIONAL {?field <http://www.researchspace.org/resource/system/fields/order> ?fieldsOrder } } ORDER BY ASC(xsd:integer(?fieldsOrder))"]]'>
--]]

<mp-event-target-template-render id="[[urlParam 'resourceconfig' escape=false]]-resourceSearch-frame" template='{{> template}}'>
  <template id='template'>
    [[#if (urlParam "searchkpcategory")]]
      <semantic-search config='[[searchConfigForFieldsFromQuery (setQueryBindings "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> . ?field <http://www.researchspace.org/resource/system/fields/range> ?range . ?field <http://www.researchspace.org/resource/system/fields/category> ?category . }" category=(urlParam "searchkpcategory" escape=false))]]'>
    [[else]]    
      <semantic-search config='[[searchConfigForFieldsFromQuery (setQueryBindings "SELECT DISTINCT ?field WHERE { ?field a <http://www.researchspace.org/resource/system/fields/Field> .  ?field <http://www.researchspace.org/resource/system/fields/domain> ?domain . ?field <http://www.researchspace.org/resource/system/fields/range> ?range . }" domain=(urlParam "resourceontologyclass" escape=false))]]'>      
    [[/if]]
      <div class="semantic-search-content">
        <div class="semantic-search-header-content">
          {{#if [[urlParam "searchall" escape=false]]}}
            <div class="semantic-search-header-title" style="min-height: 31px; min-width: 340px;flex: 0;"></div>
          {{else}}
            <h3 class="semantic-search-header-title">[[urlParam "resourcelabel" escape=false]]</h3>
          {{/if}}
      
          <div class="semantic-search-header-actions">

            [[!-- New button --]]
            <semantic-switch query='SELECT ?resourceConfig {
                                      BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                    }'>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative'>
                <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                  <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                                          urlqueryparam-view='semantic-narrative'>
                    <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                      <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                      <span>New [[urlParam "resourcelabel" escape=false]]</span>
                    </button>                 
                  </semantic-link-container>
                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                            urlqueryparam-view="semantic-narrative"
                                            urlqueryparam-open-as-drag-and-drop='true'>
                    <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                      <rs-icon icon-type="round" icon-name="open_in_new"></rs-icon>
                    </button>
                  </semantic-link-container>
                </div>  
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map'>
                <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                  <semantic-link-container uri="http://www.researchspace.org/resource/ThinkingFrames" 
                                          urlqueryparam-view='knowledge-map'>
                    <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                      <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                      <span>New [[urlParam "resourcelabel" escape=false]]</span>
                    </button>                 
                  </semantic-link-container>
                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                            urlqueryparam-view="knowledge-map"
                                            urlqueryparam-open-as-drag-and-drop='true'>
                    <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                      <rs-icon icon-type="round" icon-name="open_in_new"></rs-icon>
                    </button>
                  </semantic-link-container>
                </div>  
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Set'>
                <div></div>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Set_item'>
                <div></div>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/User'>
                <div></div>
              </template>

              <template id='http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation'>
                <div></div>
              </template>

              <template id='default'>
                [[#if (urlParam "resourceform")]]
                  <div class="btn-newDraggableTab-container" style="margin-right: 20px;">
                    <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                              urlqueryparam-view="resource-editor"
                                              urlqueryparam-entity-type-config='[[urlParam "resourceconfig" escape=false]]'
                                              urlqueryparam-mode='new'
                                              urlqueryparam-custom-label='New [[urlParam "resourcelabel" escape=false]]'>
                      <button id="create-new-btn" class="btn btn-action btn-textAndIcon">
                        <rs-icon icon-type="round" icon-name="add_box"></rs-icon>
                        <span>New [[urlParam "resourcelabel" escape=false]]</span>
                      </button>
                    </semantic-link-container>
                    <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                              urlqueryparam-view="resource-editor"
                                              urlqueryparam-entity-type-config='[[urlParam "resourceconfig" escape=false]]'
                                              urlqueryparam-mode='new'
                                              urlqueryparam-open-as-drag-and-drop='true'
                                              urlqueryparam-custom-label='New [[urlParam "resourcelabel" escape=false]]'>
                      <button class="btn btn-action btn-textAndIcon btn-newDraggableTab" title='Open in new draggable tab'>
                        <rs-icon icon-type="round" icon-name="open_in_new"></rs-icon>
                      </button>
                    </semantic-link-container>
                  </div>

                  [[!--  <mp-overlay-dialog id="[[urlParam 'viewid' escape=false]]-newResource-modal" title="New [[urlParam 'resourcelabel' escape=false]]" type="lightbox">
                          <mp-overlay-dialog-trigger>
                          </mp-overlay-dialog-trigger>
                          <mp-overlay-dialog-content>
                            <div>
                              <inline-template  template-iri="[[urlParam 'resourceform' escape=false]]"
                                                options='{
                                                          "mode": "new",
                                                          "editable": true,
                                                          "viewId": "[[urlParam "viewid" escape=false]]"
                                                        }'>
                              </inline-template>
                            </div>
                          </mp-overlay-dialog-content>
                        </mp-overlay-dialog>
                  --]]
                [[else]]
                [[/if]]
              </template>

            </semantic-switch>

            <div class="search-results-header-keyword">
              <semantic-search-query-keyword  domain='[[urlParam "resourceontologyclass" escape=false]]'
                                              query='SELECT ?subject WHERE { 
                                                      ?subject a [[urlParam "resourceontologyclass" escape=false]] .
                                                      
                                                      [[#if (urlParam "resourcetype")]] 
                                                        ?subject crm:P2_has_type [[urlParam "resourcetype" escape=false]] .
                                                      [[/if]]
                                                    
                                                      BIND(?subject as ?item) .
    
                                                      [[#if (urlParam "resourcerestrictionpattern")]] 
                                                        [[urlParam "resourcerestrictionpattern" escape=false]] 
                                                      [[/if]]     
    
                                                      [[#if (urlParam "resourcelabelpattern")]]
                                                        [[urlParam "resourcelabelpattern" escape=false]]
                                                      [[else]]
                                                        ?subject rdfs:label ?label .
                                                      [[/if]]

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                        MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                                      {{/if}}

                                                      {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")}}
                                                        MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                                      {{/if}}
                                                      SERVICE <http://www.bigdata.com/rdf/search#search> {
                                                        ?label bds:search ?__token__ ;
                                                        bds:minRelevance "0.3" ;
                                                        bds:matchAllTerms "true"  .
                                                      }
                                                    }'
    
                                                default-query='SELECT ?subject WHERE { 
                                                                ?subject a [[urlParam "resourceontologyclass" escape=false]] .
                                                                
                                                                [[#if (urlParam "resourcetype")]] 
                                                                  ?subject crm:P2_has_type [[urlParam "resourcetype" escape=false]] .
                                                                [[/if]]
    
                                                                BIND(?subject as ?item) .
    
                                                                [[#if (urlParam "resourcerestrictionpattern")]] 
                                                                  [[urlParam "resourcerestrictionpattern" escape=false]] 
                                                                [[/if]]
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                                                  MINUS {?subject prov:wasAttributedTo ?__useruri__ ; rdfs:label "Uncategorized" .}
                                                                {{/if}}
                                                                {{#if (eq "[[urlParam "resourceconfig" escape=false]]" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Actor")}}
                                                                  MINUS {?subject crm:P2_has_type <http://www.researchspace.org/resource/system/vocab/resource_type/user> .}
                                                                {{/if}}
                                                              }'
                                                debounce=300
                                                placeholder="Search [[urlParam 'resourcelabel' escape=false]]"
              ></semantic-search-query-keyword>
            </div>

            [[!-- View as dropdown/button --]]
            <semantic-query query='SELECT ?resourceConfig ?viewid ?searchViewType ?searchViewLabel WHERE {
                                    BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                    BIND("[[urlParam "viewid" escape=false]]" as ?viewid)
                                    ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_view_type> ?searchViewType.
                                    ?searchViewType crm:P71i_is_listed_in <http://www.researchspace.org/resource/system/vocab/search_view_type> .
                                    ?searchViewType skos:prefLabel ?searchViewLabel .
                                  } '

                            template='{{> search-views}}'
            >
              <template id='search-views'>
                <div>
                  {{#if bindings.1.searchViewType.value}}
                    <mp-event-target-template-render id="{{bindings.0.viewid.value}}-search-view-dropdown-area" template="{{> viewDropdown}}">
                      <template id='viewDropdown'>
                        <bs-dropdown id="{{bindings.0.viewid.value}}-view-type-selection"
                                      bs-style="default"
                                      class="btn-textAndIcon"
                                      pull-right=true
                                      title="{{#if viewTypeIndex}}{{#with (lookup bindings viewTypeIndex)}}{{searchViewLabel.value}}{{/with}}{{else}}List{{/if}}"
                        > 
                          <bs-dropdown-toggle>
                            <div>
                              <span class="color-secondary-light" style="font-weight: 400;">View as: </span>
                              <span style="font-weight: 600;">{{#if viewTypeIndex}}{{#with (lookup bindings viewTypeIndex)}}{{searchViewLabel.value}}{{/with}}{{else}}List{{/if}}</span>
                            </div>
                          </bs-dropdown-toggle>

                          <bs-dropdown-menu>
                            {{#each bindings}}
                              <mp-event-trigger id='{{../bindings.0.viewid.value}}-view-type-trigger' 
                                                type='Component.TemplateUpdate' 
                                                data='{"viewTypeIndex": "{{@index}}",
                                                      "searchViewType": "{{searchViewType.value}}"}' 
                                                targets='["{{../bindings.0.viewid.value}}-search-view-dropdown-area",
                                                          "{{../bindings.0.viewid.value}}-search-result-views"
                                                        ]'>
                                <bs-menu-item event-key="{{searchViewLabel.value}}" 
                                              active='{{#if ../viewTypeIndex}}{{#ifCond ../viewTypeIndex "==" @index}}true{{else}}false{{/ifCond}}{{else}}{{#ifCond searchViewType.value "==" "http://www.researchspace.org/resource/system/vocab/search_view_type/list"}}true{{else}}false{{/ifCond}}{{/if}}'>
                                  {{searchViewLabel.value}}
                                </bs-menu-item>
                              </mp-event-trigger> 
                            {{/each}}
                          </bs-dropdown-menu>

                        </bs-dropdown>
                      </template>
                    </mp-event-target-template-render>
                  {{else}}

                  {{/if}}
                </div>
              </template>
            </semantic-query>

            [[!-- Refresh button --]]
            <mp-event-trigger id="[[urlParam 'viewid' escape=false]]-search-refresh-trigger" 
                                  type='Component.TemplateUpdate' 
                                  targets='["[[urlParam "resourceconfig" escape=false]]-resourceSearch-frame"]'
                                  >
              <button class="btn btn-default btn-textAndIcon">
                <rs-icon icon-type="round" icon-name="refresh" title="Refresh results"></rs-icon>
              </button>
            </mp-event-trigger>

            [[!-- More actions button --]]
            <bs-dropdown id="[[urlParam 'viewid' escape=false]]-search-actions-dropdown" pull-right=true class="dropdown-no-caret">
              <bs-dropdown-toggle>
                <rs-icon icon-type="round" icon-name="more_vert"></rs-icon>
              </bs-dropdown-toggle>
              <bs-dropdown-menu>

                {{#ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image"}}
                  <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-side-by-side-action' selection='item-selection-aggregator'>
                    <rs-iiif-side-by-side-action icon="splitscreen_vertical_add" [[> rsp:IIIFConfig]] ></rs-iiif-side-by-side-action>
                  </mp-selection-action-choice>
          
                  <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-overlay-action' selection='item-selection-aggregator'>
                    <rs-iiif-overlay-action icon="layers" [[> rsp:IIIFConfig]]></rs-iiif-overlay-action>
                  </mp-selection-action-choice>
            
                  <hr>
                {{/ifCond}}

                {{#ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set"}}
                {{else ifCond "[[urlParam "resourceconfig" escape=false]]" "==" "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map"}}
                {{else}}
                  [[#if (hasPermission "forms:ldp:*")]]
                    <mp-selection-action-choice id='[[urlParam "viewid" escape=false]]-create-set-action' selection='item-selection-aggregator'>
                      <mp-create-set-action id="[[urlParam 'viewid' escape=false]]-new-set-with-results" icon="create_new_folder"></mp-create-set-action>
                    </mp-selection-action-choice>
                  [[/if]]

                  <mp-anonymous-hidden>
                    <semantic-search-action-save-set-result id='[[urlParam "viewid" escape=false]]-create-set-result-action'>
                      <bs-menu-item>
                        <rs-icon icon-type="rounded" icon-name="create_new_folder" class="icon-left" symbol="true"></rs-icon>
                        <span>New set with results</span>
                      </bs-menu-item>  
                    </semantic-search-action-save-set-result>
                  </mp-anonymous-hidden>

                  [[#if (hasPermission "forms:ldp:*")]]
                    <hr>
                  [[/if]]
                {{/ifCond}}

        [[!--        <mp-anonymous-hidden>
                  <semantic-search-action-save-search-result id='save-search-result-action' add-to-default-set=true>
                    <bs-menu-item>
                      <rs-icon icon-type="rounded" icon-name="save" class="icon-left" symbol="true"></rs-icon>
                      <span>Save search in clipboard</span>
                    </bs-menu-item>
                  </semantic-search-action-save-search-result>
                </mp-anonymous-hidden>

                <mp-anonymous-hidden><hr></mp-anonymous-hidden>
         --]]       
                <semantic-search-result>
                  <mp-sparql-download id='csv-result' 
                                      query="SELECT ?subject WHERE { }"
                                      header="text/csv"
                                      filename="[[urlParam 'resourcelabel' escape=false]]-csv-result.csv">
                    <bs-menu-item>
                      <rs-icon icon-type="rounded" icon-name="file_download" class="icon-left" symbol="true"></rs-icon>
                      <span>Export as CSV</span>
                    </bs-menu-item>
                  </mp-sparql-download>
                </semantic-search-result>
                  
                <semantic-search-result>
                  <mp-sparql-download id='json-result' 
                                      query="SELECT ?subject WHERE { }"
                                      header="application/sparql-results+json"
                                      filename="[[urlParam 'resourcelabel' escape=false]]-json-result.json"
                  >
                    <bs-menu-item>
                      <rs-icon icon-type="rounded" icon-name="file_download" class="icon-left" symbol="true"></rs-icon>
                      <span>Export as JSON</span>
                    </bs-menu-item>
                  </mp-sparql-download>
                </semantic-search-result>
                
              </bs-dropdown-menu>
            </bs-dropdown>

          </div>
        </div>

        <mp-event-target-template-render id='[[urlParam "viewid" escape=false]]-created-new-set-message' template='{{> template}}'>
          <template id='template'>
            {{#if hideMessage}}
            {{else if setCreated}}
                <div class='success-documentation-section success-documentation-section-withIcon' style="width: 100%; margin-top: 5px; margin-bottom: 10px;">
                  <div class="success-documentation-section-icon-container">
                    <rs-icon icon-type="round" icon-name="done"></rs-icon>
                  </div>

                  <div style="flex: 1;"> 
                    <div class="success-documentation-section-title">New set created!</div>
                    <div class="success-documentation-section-content" style="display: flex; gap: 5px;">
                      <mp-draggable iri='{{containerIri}}'>
                        <div>
                          <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                          urlqueryparam-view='single-set-management'
                                          urlqueryparam-resource='{{containerIri}}'>
                            <mp-label iri='{{containerIri}}' class="text-link color-success-text"></mp-label>
                          </semantic-link>
                        </div>
                      </mp-draggable>
                      <span> has been created.</span>
                    </div>
                  </div>
                  
                  <mp-event-trigger id='[[urlParam "viewid" escape=false]]-created-set-close-message'
                                    type='Component.TemplateUpdate'
                                    data='{ "hideMessage": "true" }'
                                    targets='["[[urlParam "viewid" escape=false]]-created-new-set-message"]'
                  >
                    <button class="btn btn-documentation">
                      <rs-icon icon-type="round" icon-name="close"></rs-icon>
                    </button>
                  </mp-event-trigger>
                </div>
            {{/if}}
          </template>
        </mp-event-target-template-render>

        <mp-splitpane id='[[urlParam "viewid" escape=false]]-search-filters-sidebar' min-size=43 default-size=230 snap-threshold=150 default-open=false always-render=true primary='second' class="search-filters-sidebar">

          <div class="search-results-area page__section-container">
            <semantic-search-facet-breadcrumbs></semantic-search-facet-breadcrumbs>

            <mp-event-target-template-render id="[[urlParam 'viewid' escape=false]]-search-result-views" template="{{> resultViews}}">
              <template id='resultViews'>
                  <semantic-search-result-holder>
                    {{#if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/grid")}}
                      [[!-- grid view --]]
                      <semantic-search-result>
                        <semantic-table id='semantic-search-result-grid'
                                        class-name="semantic-search-result-grid"
                                        query='SELECT DISTINCT ?subject ?iri ?resourceOntologyClass WHERE {
                                                    BIND(?subject as ?iri) .
                                                    BIND(IRI([[urlParam "resourceontologyclass" escape=false]]) AS ?resourceOntologyClass ).
                                                } ORDER BY ?subject'
                                        tuple-template='{{> gridItem }}'
                                        options='{"showFilter":false,
                                                  "resultsPerPage":100
                                                }'
                        >
                          <template id='gridItem'>
                            <div>
                              <mp-draggable iri='{{iri.value}}'>
                                {{#bind iri=iri.value}}
                                  {{> rsp:ResourceCard  selectionToggle=true 
                                                        resourceConfig="[[urlParam 'resourceconfig' escape=false]]" 
                                                        resourceLabel="[[urlParam 'resourcelabel' escape=true]]"
                                                        resourceOntologyClass=resourceOntologyClass.value
                                                        resourceIcon="[[urlParam 'resourceicon' escape=true]]"  
                                                        resourceFormIRI="[[urlParam "resourceform" escape=false]]"
                                                        viewId=__semanticTableIndex.value
                                                        searchCard=true
                                  }}
                                {{/bind}}
                              </mp-draggable>
                            </div>
                          </template>
                        </semantic-table>

                        [[> numberOfResults]]
                      </semantic-search-result>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/map")}}
                      <div>no map results</div>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/timeline")}}
                    [[!-- timeline view --]]
                      <div>
                        <semantic-search-result>
                          <mp-sparql-result-counts id='timeline-search-result-count' query="SELECT DISTINCT ?subject {} LIMIT 100"
                                                      template='{{> template}}'
                          >
                              <template id='template'>
                                {{#if hasLimit}}
                                  <bs-alert bs-style="warning" class="search-results__alert">
                                    <rs-icon icon-type="round" icon-name="report_problem"></rs-icon>
                                    <span class="num-results">There were {{totalNumberOfResults}} results. Only 100 can be visualised on the timeline at once!</span>
                                  </bs-alert>
                                {{/if}}
                              </template>
                          </mp-sparql-result-counts>
                        </semantic-search-result>

                        <semantic-search-result-context ranges='["http://www.cidoc-crm.org/cidoc-crm/E52_Time-Span"]'>
                          <semantic-search-result  id='semantic-search-result-timeline'>
                              <mp-component-toolbar>
                                <mp-component-toolbar-actions>
                                    <mp-component-toolbar-action-save id='persit-component-action' add-to-default-set=true></mp-component-toolbar-action-save>
                                </mp-component-toolbar-actions>

                                <mp-component-toolbar-component>
                                    <semantic-timeline  id='search-result-timeline'
                                                        query='PREFIX crm: <http://www.cidoc-crm.org/cidoc-crm/>
                                                                SELECT DISTINCT ?start ?end ?iri WHERE {
                                                                FILTER(?__contextRelationPattern__).
                                                                ?__value__ crm:P82a_begin_of_the_begin ?start ;
                                                                        crm:P82b_end_of_the_end ?end .
                                                                
                                                                BIND(?subject as ?iri) .
                                                                }
                                                                ORDER BY ?subject
                                                                LIMIT 100'
                                                        tuple-template='{{> timelineItem}}'
                                                        tuple-template-height=50>

                                      <template id='timelineItem'>
                                          <mp-popover>
                                            <mp-popover-trigger placement="top" trigger='["hover"]' root-close='false'>
                                                <div data-flex-layout='column top-left'>
                                                <p>{{start.value}} - {{end.value}}</p>
                                                <semantic-link iri='{{iri.value}}'></semantic-link>
                                                </div>
                                            </mp-popover-trigger>
                                            <mp-popover-content>
                                              {{> rsp:ResourceCard  iri=iri.value
                                                                    viewId="timeline"
                                              }}
                                            </mp-popover-content>
                                          </mp-popover>
                                      </template>
                                    </semantic-timeline>
                                </mp-component-toolbar-component>
                              </mp-component-toolbar>
                          </semantic-search-result>
                        </semantic-search-result-context>
                      </div>
                    {{else if (eq searchViewType "http://www.researchspace.org/resource/system/vocab/search_view_type/chart")}}
                      [[!-- chart view --]]
                      <semantic-search-result-context ranges='["http://www.w3.org/2004/02/skos/core#Concept", "http://www.cidoc-crm.org/cidoc-crm/E53_Place"]'>
                        <semantic-search-result id='semantic-search-result-chart'>
                          <mp-component-toolbar>
                              <mp-component-toolbar-actions>
                                <semantic-chart-type-selector id='search-result-chart-type-selector' default="bar" types='["line", "bar", "radar", "pie", "donut"]'></semantic-chart-type-selector>
                                  <mp-component-toolbar-action-download></mp-component-toolbar-action-download>
                                  <mp-component-toolbar-action-save id='persit-component-action' add-to-default-set=true></mp-component-toolbar-action-save>
                              </mp-component-toolbar-actions>
                              <mp-component-toolbar-component>
                                <semantic-chart
                                    id='search-result-chart'
                                    query='
                                      SELECT ?__value__ (COUNT(DISTINCT ?subject) as ?count) WHERE {
                                        OPTIONAL { FILTER(?__contextRelationPattern__) }
                                        BIND(IF(BOUND(?__value__), ?__value__, "Unknown") as ?__value__)
                                      } GROUP BY ?__value__ ORDER BY DESC(?count)
                                    '
                                    sets='[{
                                      "category": "__value__",
                                      "value": "count"
                                    }]'>
                                </semantic-chart>
                              </mp-component-toolbar-component>
                          </mp-component-toolbar>
                        </semantic-search-result>
                      </semantic-search-result-context>
                    {{else}}
                      [[!-- list view --]]
                      <semantic-query query=' SELECT DISTINCT ?resourceConfig 
                                                              ?columnTitle1 ?columnTitle2 ?columnTitle3 ?columnTitle4
                                                              ?columnContentType2 ?columnContentType3 ?columnContentType4
                                                              ?columnContentSparqlPattern2 ?columnContentSparqlPattern3 ?columnContentSparqlPattern4 
                                              WHERE {
                                                BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig)
                                                ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn .

                                                OPTIONAL {
                                                  BIND(URI(CONCAT(STR(?resourceConfig),"/resource_search_listView_column/1")) as ?customListViewColumn1) .
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn1 .
                                                  ?customListViewColumn1 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "1" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle1 .
                                                }
                                                OPTIONAL {
                                                  BIND(URI(CONCAT(STR(?resourceConfig),"/resource_search_listView_column/2")) as ?customListViewColumn2) .
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn2 .
                                                  ?customListViewColumn2 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "2" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle2 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType2 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern2 .
                                                }
                                                OPTIONAL {
                                                  BIND(URI(CONCAT(STR(?resourceConfig),"/resource_search_listView_column/3")) as ?customListViewColumn3) .
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn3 .
                                                  ?customListViewColumn3 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "3" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle3 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType3 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern3 .
                                                }
                                                OPTIONAL {
                                                  BIND(URI(CONCAT(STR(?resourceConfig),"/resource_search_listView_column/4")) as ?customListViewColumn4) .
                                                  ?resourceConfig <http://www.researchspace.org/pattern/system/resource_configuration/resource_search_listView_column> ?customListViewColumn4 .
                                                  ?customListViewColumn4 <http://www.researchspace.org/pattern/system/resource_search_listView_column/order> "4" ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/title> ?columnTitle4 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_type> ?columnContentType4 ;
                                                    <http://www.researchspace.org/pattern/system/resource_search_listView_column/content_sparql_pattern> ?columnContentSparqlPattern4 .
                                                }
                                              } LIMIT 1'

                                      template='{{> custom-list-view}}'
                                      no-result-template='{{> default-list-view}}'>
                      
                        <template id='custom-list-view'>
                          <semantic-search-result>
                            <semantic-table id='semantic-search-result-list'
                                            class-name="semantic-search-custom-result-list table-fixed-header table-scrollable-content table-expanded"

                                            query='SELECT DISTINCT ?subject ?iri ?description WHERE {
                                                    BIND(?subject as ?iri) .
                                                    #?subject a ?type .
                                                    #?type rdfs:label ?typeLabel .
                                                    #FILTER (lang(?typeLabel) = "en")

                                                    OPTIONAL {
                                                      ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                      ?information_object a crm:E73_Information_Object .
                                                      ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                      ?information_object crm:P190_has_symbolic_content ?description . 
                                                    }
                                                  } ORDER BY ?subject'
    
                                            options='{"showFilter":false, 
                                                      "resultsPerPage":50,
                                                      "useFixedHeader":true
                                                     }' 

                                            column-configuration='[
                                                                    {"variableName": "subject", "displayName": "", "cellTemplate": "{{> selectionCheckbox}}" },
                                                                    {"variableName": "subject", "displayName": "{{#if bindings.0.columnTitle1.value}}{{bindings.0.columnTitle1.value}}{{else}}[[urlParam "resourcelabel" escape=false]] name{{/if}}", "cellTemplate": "{{> column1}}" },
                                                                    {"variableName": "", "displayName": "{{#if bindings.0.columnTitle2.value}}{{bindings.0.columnTitle2.value}}{{else}}Description{{/if}}", "cellTemplate": "{{> column2}}" },
                                                                    {"variableName": "", "displayName": "{{#if bindings.0.columnTitle3.value}}{{bindings.0.columnTitle3.value}}{{else}}{{/if}}", "cellTemplate": "{{> column3}}" },
                                                                    {"variableName": "", "displayName": "{{#if bindings.0.columnTitle4.value}}{{bindings.0.columnTitle4.value}}{{else}}{{/if}}", "cellTemplate": "{{> column4}}" },
                                                                    {"variableName": "", "displayName": "more", "cellTemplate": "{{> actions}}" }
                                                                  ]'   
                            >
    
                              <template id='selectionCheckbox'>
                                [[#if (hasPermission "forms:ldp:*")]]
                                  {{#if (or (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set") (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map"))}}
                                  {{else}}
                                    <div class=''>
                                      <mp-selection-toggle selection="item-selection-aggregator" tag="{{iri.value}}"></mp-selection-toggle>
                                    </div>
                                  {{/if}}
                                [[/if]]
                              </template>
    
                              <template id='column1'>
                                <div>
                                  <div style="display: flex; align-items: center; gap: 15px;">                               
                                    <mp-draggable iri='{{iri.value}}'>
                                      <mp-overlay-dialog  id="[[urlParam 'viewid' escape=false]]-resource-preview-dialog"  
                                                          type="modal" 
                                                          class="modal-xlSize preview_modal"
                                                          title="Preview">
                                        <mp-overlay-dialog-trigger>
                                          <div class="table-image-container">
                                            {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation")}}
                                              <rs-iiif-image-thumbnail  height='40' width='45' style='height: 100%; width: 100%;'
                                                                        image-or-region='{{iri.value}}'      
                                                                        [[> rsp:IIIFConfig]]
                                                                      >
                                              </rs-iiif-image-thumbnail>
                                            {{else}}
                                              <mp-resource-thumbnail iri='{{iri.value}}' class='table-thumbnail-container'>
                                                  <mp-resource-thumbnail-fallback>
                                                    <mp-draggable iri='{{iri.value}}'>
                                                      [[#if (urlParam 'resourceicon') ]]
                                                        <rs-icon icon-type="rounded" icon-name="[[urlParam 'resourceicon']]" symbol=true class='table-thumbnail-fallback-icon'></rs-icon>
                                                      [[else]]
                                                        <rs-icon icon-type="rounded" icon-name="image" symbol=true class='table-thumbnail-fallback-icon'></rs-icon>
                                                      [[/if]]
                                                    </mp-draggable>
                                                  </mp-resource-thumbnail-fallback>
                                              </mp-resource-thumbnail>
                                            {{/if}}         
                                          </div>
                                        </mp-overlay-dialog-trigger>
                                        <mp-overlay-dialog-content>
                                          <inline-template template-iri='[[resolvePrefix "rsp:ResourcePreview"]]' 
                                                          options='{"resource": "{{iri.value}}", 
                                                                      "resourceConfig": "{{bindings.0.resourceConfig.value}}", 
                                                                      "resourceConfigLabel": "[[urlParam "resourcelabel" escape=false]]",
                                                                      "resourceDescription": "{{description.value}}",
                                                                      "modalId": "[[urlParam "viewid" escape=false]]-resource-preview-dialog",
                                                                      "resourceDetailSection": true
                                                                      }' >
                                          </inline-template> 
                                        </mp-overlay-dialog-content>
                                      </mp-overlay-dialog>
                                    </mp-draggable>

                                    <div>
                                      <mp-draggable iri='{{iri.value}}'>
                                        <div>
                                          {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")}}
                                            <mp-event-trigger id='{{iri.value}}-open-km-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"knowledge-map", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='single-set-management'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='{{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative")}}semantic-narrative{{else}}resource-editor{{/if}}'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{/if}}
                                        </div>
                                      </mp-draggable>

                                      {{#if (eq bindings.0.resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/User")}}
                                        <semantic-query query='SELECT DISTINCT ?systemUser ?subject WHERE { 
                                                                BIND(IRI(REPLACE(STR(?__useruri__), "%40", "_")) as ?systemUser)
                                                                BIND(<{{iri.value}}> as ?subject)
                                                              } LIMIT 1'>
                                          <template id='template'>
                                            {{#ifCond bindings.0.systemUser.value "===" bindings.0.subject.value}}
                                              <div>test</div>
                                            {{else}}
                                              <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                            {{/ifCond}}
                                          </template>
                                        </semantic-query>
                                      {{else}}
                                        <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                      {{/if}}
                                    </div>
                                  </div>
                                </div>
                              </template>

                              <template id='column2'>
                                {{#if bindings.0.columnContentSparqlPattern2.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?columnContentType2 ?itemIri WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType2.value}}" AS ?columnContentType2)
                                                            {{bindings.0.columnContentSparqlPattern2.value}}
                                                          }'
                                                    template='{{> customColumnContent}}'
                                                    no-result-template='{{> noResults}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType2.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="round" icon-name="people_alt" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType2.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                              {{#each bindings}}
                                                {{#if (eq columnContentType2.value "date")}}
                                                  <mp-draggable iri='{{value.value}}'><span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span></mp-draggable>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{else if (eq columnContentType2.value "link")}}
                                                  <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                            urlqueryparam-view="resource-editor"
                                                                            urlqueryparam-resource-iri='{{value.value}}'>
                                                    <span class="text-link">{{label.value}}</span>
                                                  </semantic-link-container>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{else if (eq columnContentType2.value "tag")}}
                                                  <span class="badge badge--secondary">{{label.value}}</span>
                                                {{else}}
                                                  <span style="{{#if (eq columnContentType2.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                  <span>{{#if @last}}{{else}}, {{/if}}</span>
                                                {{/if}}
                                              {{/each}}
                                              {{#if (eq bindings.0.columnContentType2.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>

                                      <template id="noResults">
                                        {{#if description.value}}
                                          <mp-text-truncate lines=1 expand='<div class="text-link">Expand</div>' collapse='<div class="text-link">Collapse</div>'>
                                          {{description.value}}
                                          </mp-text-truncate>
                                        {{/if}}
                                      </template>
                                  </semantic-query>
                                {{else}}
                                  <div>
                                    {{description.value}}
                                  </div>
                                {{/if}}
                              </template>

                              <template id='column3'>
                                {{#if bindings.0.columnContentSparqlPattern3.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?itemIri ?columnContentType3 WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType3.value}}" AS ?columnContentType3)
                                                            {{bindings.0.columnContentSparqlPattern3.value}}
                                                          }'
                                                    template='{{> customColumnContent}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType3.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="round" icon-name="people_alt" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType3.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                            {{#each bindings}}
                                              {{#if (eq columnContentType3.value "date")}}
                                                <mp-draggable iri='{{value.value}}'><span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span></mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType3.value "link")}}
                                                <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                          urlqueryparam-view="resource-editor"
                                                                          urlqueryparam-resource-iri='{{value.value}}'>
                                                  <span class="text-link">{{label.value}}</span>
                                                </semantic-link-container>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType3.value "tag")}}
                                                <span class="badge badge--secondary">{{label.value}}</span>
                                              {{else}}
                                                <span style="{{#if (eq columnContentType3.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{/if}}
                                            {{/each}}
                                            {{#if (eq bindings.0.columnContentType3.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>
                                  </semantic-query>
                                {{/if}}
                              </template>    

                              <template id='column4'>
                                {{#if bindings.0.columnContentSparqlPattern4.value}}
                                  <semantic-query query='SELECT ?item ?value ?label ?itemIri ?columnContentType4 WHERE {
                                                            BIND(<{{iri.value}}> AS ?item)
                                                            BIND("{{bindings.0.columnContentType4.value}}" AS ?columnContentType4)
                                                            {{bindings.0.columnContentSparqlPattern4.value}}
                                                          }'
                                                    template='{{> customColumnContent}}'
                                    >

                                      <template id='customColumnContent'>
                                        <div>
                                          {{#if (eq bindings.0.columnContentType4.value "icon actor")}}
                                            <mp-popover>
                                              <mp-popover-trigger placement="bottom" trigger='["click", "focus"]'> 
                                                <rs-icon icon-type="round" icon-name="people_alt" class="people-icon"></rs-icon>
                                              </mp-popover-trigger>
                                              <mp-popover-content>
                                                <div style="display: flex; flex-direction: column; gap: 5px;">
                                                  {{#each bindings}}
                                                    <mp-draggable iri='{{value.value}}'>
                                                      <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                                urlqueryparam-view="resource-editor"
                                                                                urlqueryparam-resource-iri='{{value.value}}'>
                                                        <div class="text-link">{{label.value}}</div>
                                                      </semantic-link-container>
                                                    </mp-draggable>
                                                  {{/each}}
                                                </div>
                                              </mp-popover-content>
                                            </mp-popover>
                                          {{else}}
                                            {{#if (eq bindings.0.columnContentType4.value "tag")}}<div style="display: flex; gap: 5px; flex-wrap: wrap;">{{/if}}
                                            {{#each bindings}}
                                              {{#if (eq columnContentType4.value "date")}}
                                                <mp-draggable iri='{{value.value}}'><span>{{dateTimeFormat label.value "DD/MM/YYYY"}}</span></mp-draggable>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType4.value "link")}}
                                                <semantic-link-container  uri='http://www.researchspace.org/resource/ThinkingFrames'
                                                                          urlqueryparam-view="resource-editor"
                                                                          urlqueryparam-resource-iri='{{value.value}}'>
                                                  <span class="text-link">{{label.value}}</span>
                                                </semantic-link-container>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{else if (eq columnContentType4.value "tag")}}
                                                <span class="badge badge--secondary">{{label.value}}</span>
                                              {{else}}
                                                <span style="{{#if (eq columnContentType4.value 'bold text')}}font-weight: 600;{{/if}}">{{label.value}}</span>
                                                <span>{{#if @last}}{{else}}, {{/if}}</span>
                                              {{/if}}
                                            {{/each}}
                                            {{#if (eq bindings.0.columnContentType4.value "tag")}}</div>{{/if}}
                                          {{/if}}
                                        </div>
                                      </template>
                                  </semantic-query>
                                {{/if}}
                              </template>

                              <template id='actions'>
                                [[> resultCardActions resourceConfig="bindings.0.resourceConfig.value" ]]
                              </template>  

                            </semantic-table>
                            [[> numberOfResults]]
                          </semantic-search-result>
                        </template>

                        <template id='default-list-view'>
                          <semantic-search-result>
                            <semantic-table id='semantic-search-result-list'
                                            class-name="semantic-search-default-result-list table-fixed-header table-scrollable-content table-expanded"
                                            query='SELECT DISTINCT ?subject ?iri ?description ?resourceConfig WHERE {
                                                    BIND(?subject as ?iri) .
                                                    BIND(<[[urlParam "resourceconfig" escape=false]]> as ?resourceConfig) .
                                                    
                                                    OPTIONAL {
                                                      ?subject crm:P67i_is_referred_to_by ?information_object  .
                                                      ?information_object a crm:E73_Information_Object .
                                                      ?information_object crm:P2_has_type <http://www.researchspace.org/resource/vocab/text_type/description> .
                                                       ?information_object crm:P190_has_symbolic_content ?description . 
                                                    }
                                                  } ORDER BY ?subject'
    
                                            options='{"showFilter":false, 
                                                      "resultsPerPage":50,
                                                      "useFixedHeader":true
                                                    }' 
                                            column-configuration='[
                                                                    {"variableName": "subject", "displayName": "", "cellTemplate": "{{> selectionCheckbox}}" },
                                                                    {"variableName": "subject", "displayName": "[[urlParam "resourcelabel" escape=false]] name", "cellTemplate": "{{> column1}}" },
                                                                    {"variableName": "description", "displayName": "Description", "cellTemplate": "{{> column2}}" },
                                                                    {"variableName": "", "displayName": "more", "cellTemplate": "{{> actions}}" }
                                                                  ]'   
                            >
    
                              <template id='selectionCheckbox'>
                                [[#if (hasPermission "forms:ldp:*")]]
                                  {{#if (or (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set") (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map"))}}
                                  {{else}}
                                    <div class=''>
                                      <mp-selection-toggle selection="item-selection-aggregator" tag="{{iri.value}}"></mp-selection-toggle>
                                    </div>
                                  {{/if}}
                                [[/if]]
                              </template>
    
                              <template id='column1'>
                                <div>
                                  <div style="display: flex; align-items: center; gap: 15px;">                                 
                                    <mp-draggable iri='{{iri.value}}'>
                                      <mp-overlay-dialog  id="[[urlParam 'viewid' escape=false]]-resource-preview-dialog"  
                                                          type="modal" 
                                                          class="modal-xlSize preview_modal"
                                                          title="Preview">
                                        <mp-overlay-dialog-trigger>
                                          <div class="table-image-container">
                                            {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Image_annotation")}}
                                              <rs-iiif-image-thumbnail  height='40' width='45' style='height: 100%; width: 100%;'
                                                                        image-or-region='{{iri.value}}'      
                                                                        [[> rsp:IIIFConfig]]
                                                                      >
                                              </rs-iiif-image-thumbnail>
                                            {{else}}
                                              <mp-resource-thumbnail iri='{{iri.value}}' class='table-thumbnail-container'>
                                                  <mp-resource-thumbnail-fallback>
                                                    <mp-draggable iri='{{iri.value}}'>
                                                      [[#if (urlParam 'resourceicon') ]]
                                                        <rs-icon icon-type="rounded" icon-name="[[urlParam 'resourceicon']]" symbol=true class='table-thumbnail-fallback-icon'></rs-icon>
                                                      [[else]]
                                                        <rs-icon icon-type="rounded" icon-name="image" symbol=true class='table-thumbnail-fallback-icon'></rs-icon>
                                                      [[/if]]
                                                    </mp-draggable>
                                                  </mp-resource-thumbnail-fallback>
                                              </mp-resource-thumbnail>
                                            {{/if}}         
                                          </div>
                                        </mp-overlay-dialog-trigger>
                                        <mp-overlay-dialog-content>
                                          <inline-template template-iri='[[resolvePrefix "rsp:ResourcePreview"]]' 
                                                          options='{"resource": "{{iri.value}}", 
                                                                      "resourceConfig": "{{resourceConfig.value}}", 
                                                                      "resourceConfigLabel": "[[urlParam "resourcelabel" escape=false]]",
                                                                      "resourceDescription": "{{description.value}}",
                                                                      "modalId": "[[urlParam "viewid" escape=false]]-resource-preview-dialog",
                                                                      "resourceDetailSection": true
                                                                      }' >
                                          </inline-template> 
                                        </mp-overlay-dialog-content>
                                      </mp-overlay-dialog>
                                    </mp-draggable>

                                    <div>
                                      <mp-draggable iri='{{iri.value}}'>
                                        <div>
                                          {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Knowledge_map")}}
                                            <mp-event-trigger id='{{iri.value}}-open-km-title-trigger' 
                                                              type='Dashboard.AddFrame'
                                                              data='{"viewId":"knowledge-map", 
                                                                      "resourceIri": "{{iri.value}}"}' 
                                                              targets='["thinking-frames"]'>
                                              <div><mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label></div>
                                            </mp-event-trigger>
                                          {{else if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Set")}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='single-set-management'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{else}}
                                            <semantic-link  iri='http://www.researchspace.org/resource/ThinkingFrames'
                                                            urlqueryparam-view='{{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/Semantic_narrative")}}semantic-narrative{{else}}resource-editor{{/if}}'
                                                            urlqueryparam-resource='{{iri.value}}'>
                                              <mp-label iri='{{iri.value}}' class="text-link text-truncate-line1"></mp-label>
                                            </semantic-link>
                                          {{/if}}
                                        </div>
                                      </mp-draggable>

                                      {{#if (eq resourceConfig.value "http://www.researchspace.org/resource/system/resource_configurations_container/data/User")}}
                                        <semantic-query query='SELECT DISTINCT ?systemUser WHERE { 
                                                                BIND(IRI(REPLACE(STR(?__useruri__), "%40", "_")) as ?systemUser)
                                                              } LIMIT 1'>
                                          <template id='template'>
                                            {{#ifCond bindings.0.systemUser.value "===" iri.value}}
                                              <div class="color-action text-bold600 text-font-size__xsmall text-truncate-line1">My profile</div>
                                            {{else}}
                                              <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                            {{/ifCond}}
                                          </template>
                                        </semantic-query>
                                      {{else}}
                                        <div class="color-secondary-light text-font-size__xsmall text-truncate-line1">[[urlParam "resourcelabel" escape=false]]</div>
                                      {{/if}}
                                    </div>
                                  </div>
                                </div>
                              </template>

                              <template id='column2'>
                                {{#if description.value}}
                                  <mp-text-truncate lines=1 expand='<div class="text-link">Expand</div>' collapse='<div class="text-link">Collapse</div>'>
                                    {{description.value}}
                                  </mp-text-truncate>
                                {{/if}}
                              </template>

                              <template id='actions'>
                                <div>
                                  [[> resultCardActions resourceConfig="resourceConfig.value" ]]
                                </div>
                              </template>
    
                            </semantic-table>
                            [[> numberOfResults]]
                          </semantic-search-result>
                        </template>

                      </semantic-query>
                    {{/if}}
                  </semantic-search-result-holder>
              </template>
            </mp-event-target-template-render>
          </div>

          <div class="split-pane__sidebar split-pane__rightsidebar">

            <mp-splitpane-toggle-on>
              <button class="btn-toggle-on" title="Filter by">
                  <div class="btn-toggle-on-content content-center">
                    <rs-icon icon-type="outlined" icon-name="filter_alt"></rs-icon>
                  </div>
              </button>
            </mp-splitpane-toggle-on>

            <mp-splitpane-toggle-off>
              <div class="split-pane__sidebar-header" style="position: relative;">
                  <button class="btn-toggle-off">
                      <div style="display: flex; align-items: center; gap: 10px;">
                          <div class="customFormHeader" style="margin-top: 0;">Filter by</div>
                      </div> 
                      <rs-icon icon-type="round" icon-name="keyboard_double_arrow_right" 
                              style="font-size: 20px;">
                      </rs-icon>
                  </button>
              </div>
            </mp-splitpane-toggle-off>

            <mp-splitpane-sidebar-open style="flex: 1; overflow: hidden;">
              <div class="split-pane__sidebar-open">
                <semantic-search-facet  id='[[urlParam "viewid" escape=false]]-semantic-search-facet'
                                        open-by-default=false 
                                        hide-toggle-button=true>
                </semantic-search-facet>
              </div>
            </mp-splitpane-sidebar-open>

          </div>

        </mp-splitpane>
      </div>
    </semantic-search> 
  </template>
</mp-event-target-template-render>

<mp-event-proxy id='[[urlParam "viewid" escape=false]]-search-refresh-on-create-set'
                on-event-types='["Components.SetManagement.SetAdded"]'
                on-event-source='[[urlParam "viewid" escape=false]]-new-set-with-results'
                proxy-event-type='Component.TemplateUpdate' 
                proxy-targets='["[[urlParam "resourceconfig" escape=false]]-resourceSearch-frame"]'
                additional-data='{"setCreated": true }' >
</mp-event-proxy>

<mp-event-proxy id='[[urlParam "viewid" escape=false]]-search-refresh-on-create-set'
                on-event-types='["Components.SetManagement.SetAdded"]'
                on-event-source='[[urlParam "viewid" escape=false]]-create-set-result-action'
                proxy-event-type='Component.TemplateUpdate' 
                proxy-targets='["[[urlParam "resourceconfig" escape=false]]-resourceSearch-frame"]'
                additional-data='{"setCreated": true }' >
</mp-event-proxy>

[[#*inline "numberOfResults"]]
  <div class="semantic-search-num-results">
    <mp-sparql-result-counts  id='semantic-search-result-count' 
                              query="SELECT DISTINCT ?subject {}"
                              template='{{> template}}'
    >
      <template id='template'>
        <div class="num-results">
            Found 
            <span class="num-results-color">{{#if hasLimit}}{{totalNumberOfResults}}{{else}}{{numberOfResults}}{{/if}}</span> 
            results
        </div>
      </template>
    </mp-sparql-result-counts>
  </div>
[[/inline ]]


[[#*inline "resultCardActions"]]
  <div style="display: flex; align-items: stretch; gap: 1px;">
    <mp-draggable iri='{{iri.value}}' drag-style="cursor: grab;">
      <button class="btn btn-default border-none" title="drag [[urlParam 'resourcelabel' escape=false]]" style="cursor: grab;">
        <rs-icon icon-type="rounded" icon-name="drag_pan" symbol="true"></rs-icon>
      </button>
    </mp-draggable>

    {{> rsp:ResourceDropdownActions viewId=[[resourceConfig]]
                                    iri=iri.value
                                    resourceConfig=[[resourceConfig]]
                                    resourceLabel="[[urlParam "resourcelabel" escape=false]]"
                                    resourceOntologyClass="[[urlParam "resourceontologyclass" escape=false]]"
                                    resourceDescription=description.value
                                    resourceFormIRI="[[urlParam "resourceform" escape=false]]"
                                    searchCard=true
    }}
  </div>
[[/inline ]]